<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro Oficial · Paröle</title>
  <style>
    body { background-color: #000; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    
    .form-register {
      background-color: #1e1e1e;
      max-width: 400px;
      width: 90%;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .form-register h2 { text-align: center; margin-bottom: 10px; }
    .form-register h3 { font-size: 13px; margin-bottom: 20px; color: #aaa; text-align: center; font-weight: normal; }

    .input-group { position: relative; width: 100%; margin: 8px 0; }
    
    input, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #333;
      background-color: #2a2a2a;
      color: #fff;
      font-size: 16px;
      box-sizing: border-box;
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #8a5de8;
      background: none;
      border: none;
      padding: 0;
      display: flex;
      align-items: center;
    }

    label { display: block; margin-top: 12px; font-size: 13px; color: #8a5de8; font-weight: bold; }

    .image-preview { margin: 10px 0; display: none; text-align: center; }
    .image-preview img { max-width: 100%; height: 120px; border-radius: 8px; border: 2px solid #8a5de8; object-fit: cover; }

    button[type="submit"] {
      width: 100%;
      padding: 14px;
      margin-top: 20px;
      background-color: #8a5de8;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover { background-color: #7a4cd8; }
    button:disabled { background-color: #444; cursor: not-allowed; }

    .checkbox-label { display: flex; align-items: center; font-size: 12px; margin-top: 15px; color: #ccc; }
    .checkbox-label input { width: auto; margin-right: 10px; }
    
    .error-text { color: #ff6b6b; font-size: 11px; margin-top: -5px; display: none; }
  </style>
</head>
<body>

  <form id="registerForm" class="form-register">
    <h2>Registro Oficial</h2>
    <h3>Acceso personal e intransferible para eventos de GRUPÖ PARÖLE.</h3>

    <input type="text" id="nombre" placeholder="Nombre completo" required>
    <input type="email" id="email" placeholder="Correo electrónico" required>
    <input type="tel" id="telefono" placeholder="Teléfono" required>

    <select id="tipo" required>
      <option value="">Tipo de cliente</option>
      <option value="Cliente">Cliente</option>
      <option value="VIP">VIP</option>
      <option value="UNIVERSITARIO">Universitario</option>
      <option value="FUERZAS">Fuerzas de Seguridad</option>
    </select>

    <label>Tu contraseña de acceso:</label>
    <div class="input-group">
        <input type="password" id="password" placeholder="Mínimo 6 caracteres" minlength="6" required>
        <button type="button" class="toggle-password" onclick="togglePass('password')">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        </button>
    </div>

    <label>Repite tu contraseña:</label>
    <div class="input-group">
        <input type="password" id="confirmPassword" placeholder="Confirma tu contraseña" required>
        <div id="passError" class="error-text">Las contraseñas no coinciden.</div>
    </div>

    <label>Foto del Documento (DNI/NIE):</label>
    <input type="file" id="docFoto" accept="image/*" capture="environment" required>
    <div class="image-preview" id="docPreview"><img src=""></div>

    <label>Selfie de Verificación:</label>
    <input type="file" id="selfie" accept="image/*" capture="user" required>
    <div class="image-preview" id="selfiePreview"><img src=""></div>

    <label class="checkbox-label">
      <input type="checkbox" required>
      Acepto el uso de mis datos para control de acceso y premios.
    </label>

    <button type="submit" id="btnSubmit">Crear Cuenta</button>
  </form>

  <script>
    // --- 1. VER/OCULTAR CONTRASEÑA ---
    function togglePass(id) {
        const input = document.getElementById(id);
        input.type = input.type === "password" ? "text" : "password";
    }

    // --- 2. PREVISUALIZACIÓN DE FOTOS ---
    function previewImage(input, previewId) {
      const previewDiv = document.getElementById(previewId);
      const previewImg = previewDiv.querySelector('img');
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
          previewImg.src = e.target.result;
          previewDiv.style.display = 'block';
        }
        reader.readAsDataURL(input.files[0]);
      }
    }

    document.getElementById('docFoto').addEventListener('change', function() { previewImage(this, 'docPreview'); });
    document.getElementById('selfie').addEventListener('change', function() { previewImage(this, 'selfiePreview'); });

    // --- 3. ENVÍO AL SERVIDOR ---
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const pass = document.getElementById('password').value;
      const confirmPass = document.getElementById('confirmPassword').value;
      const passError = document.getElementById('passError');

      // Validar coincidencia
      if (pass !== confirmPass) {
        passError.style.display = 'block';
        document.getElementById('confirmPassword').style.borderColor = '#ff6b6b';
        return;
      } else {
        passError.style.display = 'none';
        document.getElementById('confirmPassword').style.borderColor = '#333';
      }

      const btn = document.getElementById('btnSubmit');
      btn.innerText = "Registrando...";
      btn.disabled = true;

      const formData = new FormData();
      formData.append('nombre', document.getElementById('nombre').value);
      formData.append('email', document.getElementById('email').value);
      formData.append('telefono', document.getElementById('telefono').value);
      formData.append('tipo', document.getElementById('tipo').value);
      formData.append('password', pass); 
      
      formData.append('docFoto', document.getElementById('docFoto').files[0]);
      formData.append('selfie', document.getElementById('selfie').files[0]);

      try {
        const response = await fetch('/api/crear-usuario', {
          method: 'POST',
          body: formData 
        });

        const result = await response.json();

        if (result.success) {
          alert('✅ ¡Registro exitoso! Ya puedes iniciar sesión.');
          window.location.href = '/login.html';
        } else {
          alert('❌ Error: ' + (result.error || 'No se pudo completar el registro'));
          btn.innerText = "Crear Cuenta";
          btn.disabled = false;
        }
      } catch (err) {
        alert('❌ Error de conexión con el servidor.');
        btn.innerText = "Crear Cuenta";
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>